function e(e){return function(r){return{}.toString.call(r)==="[object "+e+"]"}}var r=e("String"),t=e("Number"),n=Array.isArray,o=e("Object"),i=e("Function");function l(e){return e&&"VNode"===e.type}function a(e){return e&&"VText"===e.type}function u(e,n){for(var o=[],i=n||{},l=null,a=arguments.length,u=new Array(a>2?a-2:0),f=2;f<a;f++)u[f-2]=arguments[f];return u.reduce(function(e,r){return e.concat(r)},[]).forEach(function(e){r(e)||t(e)?o.push({type:"VText",text:String(e)}):o.push(e)}),i.hasOwnProperty("key")&&(l=i.key.toString(),delete i.key),{type:"VNode",tag:e,key:l,props:i||{},children:o}}var f={INSERT:"INSERT",REPLACE:"REPLACE",REMOVE:"REMOVE",ORDER:"ORDER",MOVE:"MOVE",VTEXT:"VTEXT",PROPS:"PROPS",SET_PROP:"SET_PROP",REMOVE_PROP:"REMOVE_PROP"},c=Object.freeze({PATCH:f});function s(e,r){var t=[];return v(e,r,t,0),t}function v(e,r,t,o){if(r!==e){var i=t[o];if(e)if(r)if(l(r))if(l(e)){if(r.tag===e.tag&&r.key===e.key){var u=function(e,r){var t=[],n=Object.assign({},e,r);return Object.keys(n).forEach(function(n){var o=e[n],i=r[n];o||t.push({type:f.REMOVE_PROP,key:n,value:i}),void 0!==i&&o===i||t.push({type:f.SET_PROP,key:n,value:o})}),t}(r.props,e.props);u&&u.length>0&&(i=h(i,{type:f.PROPS,patches:u})),i=function(e,r,t,o,i){for(var a=e.children,u=function(e,r){var t=y(r),n=t.keys,o=t.free;if(o.length===r.length)return{children:r,moves:null};var i=y(e),l=i.keys;if(i.free.length===e.length)return{children:r,moves:null};for(var a=[],u=o.length,f=0,c=0,s=0;s<e.length;s++){var v=e[s],h=void 0;v.key?n.hasOwnProperty(v.key)?(h=n[v.key],a.push(r[h])):(c++,a.push(null)):f<u?(h=o[f++],a.push(r[h])):(c++,a.push(null))}for(var p=f>=o.length?r.length:o[f],m=0;m<r.length;m++){var k=r[m];k.key?l.hasOwnProperty(k.key)||a.push(k):m>=p&&a.push(k)}for(var g,E,b=a.slice(),O=[],R=[],T=0,x=0;x<r.length;){for(E=r[x],g=b[T];null===g&&b.length;)O.push(d(b,T,null)),g=b[T];g&&g.key===E.key?(T++,x++):E.key?(g&&g.key&&n[g.key]!==x+1?(O.push(d(b,T,g.key)),(g=b[T])&&g.key===E.key?T++:R.push({key:E.key,to:x})):R.push({key:E.key,to:x}),x++):g&&g.key&&O.push(d(b,T,g.key))}for(;T<b.length;)g=b[T],O.push(d(b,T,g&&g.key));if(O.length===c&&!R.length)return{children:a,moves:null};return{children:a,moves:{removes:O,inserts:R}}}(a,r.children),c=u.children,s=a.length,p=c.length,m=s>p?s:p,k=0;k<m;k++){var g=a[k],E=c[k];i++,g?v(g,E,t,i):E&&(o=h(o,{type:f.INSERT,vNode:E})),l(g)&&n(g.children)&&(i+=g.children.length)}u.moves&&(o=h(o,{type:f.ORDER,moves:u.moves}));return o}(e,r,t,i,o)}}else i=h(i,{type:f.REPLACE,vNode:r});else a(r)&&(a(e)?r.text!==e.text&&(i=h(i,{type:f.VTEXT,vNode:r})):i=h(i,{type:f.VTEXT,vNode:r}));else i=h(i,{type:f.REMOVE,vNode:null});else i=h(i,{type:f.INSERT,vNode:r});i&&(t[o]=i)}}function d(e,r,t){return e.splice(r,1),{from:r,key:t}}function y(e){for(var r={},t=[],n=e.length,o=0;o<n;o++){var i=e[o];i.key?r[i.key]=o:t.push(o)}return{keys:r,free:t}}function h(e,r){return e?(n(e)?e.push(r):e=[e,r],e):r}function p(e,r,t){if(r!==e){var n=r.tag;if(e.tag!==n)m(r,t,e,!0);else{var o=e.children,i=r.children,l=e.dom;r.dom=l,i!==o&&function(e,r,t,n){var o=t.length;if(0===o)return void k(e,n);var i=n.length;if(0===i)return void function(e,r){g(e,r,0,r.length)}(e,t);if(i<2){var l=n[0];if(a(l)){var u=l.text;if(i===o){var f=t[0];return u===f.text?void 0:void(e.firstChild.nodeValue=u)}!function(e,r){if(r)e.innerText=r;else for(;e.firstChild;)e.removeChild(e.firstChild)}(e,u)}else if(o<2){var c=t[0],s=n[0];return void p(c,s,e)}}var v,d=o-1,y=i-1,h=0,b=0,O=!0;e:for(;O&&h<=d&&b<=y;){O=!1;for(var R=t[h],T=n[b];R.key===T.key;){if(p(R,T,e),b++,++h>d||b>y)break e;R=t[h],T=n[b],O=!0}for(var x=t[d],P=n[y];x.key===P.key;){if(p(x,P,e),y--,h>--d||b>y)break e;x=t[d],P=n[y],O=!0}for(;R.key===P.key;){if(v=y+1<i?n[y+1]:null,p(R,P,e),E(e,P,v),y--,++h>d||b>y)break e;R=t[h],P=n[y],O=!0}for(;x.key===T.key;){if(v=h<o?t[h]:null,p(x,T,e),E(e,T,v),b++,h>--d||b>y)break e;x=t[d],T=n[b],O=!0}}if(h>d){v=y+1<i?n[y+1]:null;for(var N=b;N<=y;N++)m(n[N],e,v)}else if(b>y)g(e,t,h,d+1);else{var S,C,V,A,w=t[d+1],j={};for(S=d;S>=h;S--)(C=t[S]).next=w,j[C.key]=C,w=C;for(V=y+1<i?n[y+1]:null,S=y;S>=b;S--){var M=(A=n[S]).key;(C=j[M])?(j[M]=null,w=C.next,p(C,A,e),e.nextSibling!==(V&&V.dom)&&E(e,A,V)):m(A,e,V),V=A}for(S=h;S<=d;S++)C=t[S],null!==j[C.key]&&e.removeChild(C)}}(l,0,o,i);var u=e.props,f=r.props;f!==u&&b(l,f,u)}}}function m(e,r,t,n){var o;if(l(e)){var i=e.children,u=e.props;o=document.createElement(e.tag),e.dom=o,i.length>0&&k(o,i),u&&b(o,u)}else a(e)&&(o=document.createTextNode(e.text),e.dom=o);r&&o&&function(e,r,t,n){if(t){var o=t.dom;n?e.replaceChild(r,o):e.insertBefore(r,o)}else e.appendChild(r)}(r,o,t,n)}function k(e,r){var t=!0,n=!1,o=void 0;try{for(var i,l=r[Symbol.iterator]();!(t=(i=l.next()).done);t=!0){m(i.value,e)}}catch(e){n=!0,o=e}finally{try{t||null==l.return||l.return()}finally{if(n)throw o}}}function g(e,r,t,n){for(;t<n;t++)e.removeChild(r[t])}function E(e,r,t){var n=t&&t.dom,o=r.dom;o!==n&&(n?e.insertBefore(o,n):e.appendChild(o))}function b(e,r,t){var n=Object.assign({},r,t);return Object.keys(n).forEach(function(n){var o=r[n],i=t[n];o||e.removeAttribute("className"===n?"class":n),void 0!==i&&o===i||e.setAttribute("className"===n?"class":n,o)}),[]}function O(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=[],n=!0,o=!1,i=void 0;try{for(var l,a=e[Symbol.iterator]();!(n=(l=a.next()).done)&&(t.push(l.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return t}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function R(e){return function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function T(e){if(a(e))return document.createTextNode(e.text);var r=e.tag,t=e.props,n=e.children,o=document.createElement(r);return function(e,r){Object.entries(r).forEach(function(r){var t=O(r,2),n=t[0],o=t[1];x(e,n,o)})}(o,t),n.map(T).forEach(o.appendChild.bind(o)),e.dom=o,o}function x(e,r,t){e.setAttribute("className"===r?"class":r,t)}function P(e,r){return e.tag===r.tag&&e.key===r.key}function N(e,r){if(e!==r){var t=r.dom=e.dom,o=e.children,i=r.children;a(r)?e.text!==r.text&&(n(o)&&A(t,o,0,o.length-1),C(t,r.text)):n(o)&&n(i)?o!==i&&function(e,r,t){var n,o,i,l,a=0,u=0,f=r.length-1,c=r[0],s=r[f],v=t.length-1,d=t[0],y=t[v];for(;a<=f&&u<=v;)null==c?c=r[++a]:null==s?s=r[--f]:null==d?d=t[++u]:null==y?y=t[--v]:P(c,d)?(N(c,d),c=r[++a],d=t[++u]):P(s,y)?(N(s,y),s=r[--f],y=t[--v]):P(c,y)?(N(c,y),V(e,c.dom,s.dom.nextSibling),c=r[++a],y=t[--v]):P(s,d)?(N(s,d),V(e,s.dom,c.dom),s=r[--f],d=t[++u]):(void 0===n&&(n=w(r,a,f)),void 0===(o=n[d.key])?(V(e,T(d),c.dom),d=t[++u]):((i=r[o]).sel!==d.sel?V(e,T(d),c.dom):(N(i,d),r[o]=void 0,V(e,i.dom,c.dom)),d=t[++u]));(a<=f||u<=v)&&(a>f?(l=null==t[v+1]?null:t[v+1].dom,S(e,l,t,u,v)):A(e,r,a,f))}(t,o,i):n(i)?(a(e)&&C(t,""),S(t,null,i,0,i.length-1)):n(o)?A(t,o,0,o.length-1):n(e.text)&&C(t,"")}}function S(e,r,t,n,o){for(;n<=o;++n){var i=t[n];null!=i&&V(e,T(i),r)}}function C(e,r){e.textContent=r}function V(e,r,t){e.insertBefore(r,t)}function A(e,r,t,n){for(;t<=n;++t){var o=r[t];null!=o&&e.removeChild(o.dom)}}function w(e,r,t){var n,o,i,l={};for(n=r;n<=t;++n)null!=(i=e[n])&&void 0!==(o=i.key)&&(l[o]=n);return l}var j={version:"1.0.0",name:"magic-dom",diffType:"virtual-dom"};function M(e,r){switch(j.diffType){case"virtual-dom":return s(e,r);case"cito":return function(e,r){p(e,r,e.dom.parentNode)}(e,r);case"snabbdom":return function(e,r){var t=e.dom;if(P(e,r))N(e,r);else{var n=t.parentNode,o=T(r);null!==n&&n.replaceChild(t,o)}}(e,r);default:return s(e,r)}}function _(e,r){if(r){var t=function(e){var r=[];for(var t in e)r.push(Number(t));return r}(r);if(0!==t.length){var n=function e(r){var t=[r];var n=r.childNodes;if(n.length){var o=!0,i=!1,l=void 0;try{for(var a,u=n[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var f=a.value;1!==f.nodeType&&3!==f.nodeType||(1===f.nodeType?t.push.apply(t,R(e(f))):3===f.nodeType&&t.push(f))}}catch(e){i=!0,l=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw l}}}return t}(e),o=!0,i=!1,l=void 0;try{for(var a,u=t[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var f=a.value;I(n[f],r[f])}}catch(e){i=!0,l=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw l}}}}}function I(e,r){if(n(r)){var t=!0,o=!1,i=void 0;try{for(var l,a=r[Symbol.iterator]();!(t=(l=a.next()).done);t=!0){X(e,l.value)}}catch(e){o=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(o)throw i}}}else X(e,r)}function X(e,r){var t=r.type,n=r.vNode,o=e.parentNode,i=null;switch(t){case f.INSERT:i=T(n),o.appendChild(i);break;case f.REMOVE:o.removeChild(e);break;case f.REPLACE:i=T(n),o.replaceChild(i,e);break;case f.ORDER:!function(e,r){var t,n=r.moves,o=n.removes,i=n.inserts,l=e.childNodes,a={},u=!0,f=!1,c=void 0;try{for(var s,v=o[Symbol.iterator]();!(u=(s=v.next()).done);u=!0){var d=s.value;(t=l[d.from])&&(d.key&&(a[d.key]=t),e.removeChild(t))}}catch(e){f=!0,c=e}finally{try{u||null==v.return||v.return()}finally{if(f)throw c}}var y=l.length,h=!0,p=!1,m=void 0;try{for(var k,g=i[Symbol.iterator]();!(h=(k=g.next()).done);h=!0){var E=k.value;(t=a[E.key])&&e.insertBefore(t,E.to>=y++?null:l[E.to])}}catch(e){p=!0,m=e}finally{try{h||null==g.return||g.return()}finally{if(p)throw m}}}(e,r);break;case f.VTEXT:i=document.createTextNode(n.text),o.replaceChild(i,e);break;case f.PROPS:!function(e,r){r.forEach(function(r){var t=r.type,n=r.key,o=r.value;switch(t){case f.SET_PROP:x(e,n,o);break;case f.REMOVE_PROP:!function(e,r){e.removeAttribute("className"===r?"class":r)}(e,n)}})}(e,r.patches)}}var B=Object.freeze({config:j,get:function(e){var r=j;return e.split(".").forEach(function(e){r=r[e]}),r},set:function(e,r){var t=j,n=e.split("."),o=n.length-1;n.forEach(function(e,n){n<o?t=t[e]:t[e]=r})},isType:e,isString:r,isNumber:t,isArray:n,isObject:o,isFunction:i,isVNode:l,isVText:a});export{M as diff,u as h,_ as patch,T as render,c as types,B as utils};
